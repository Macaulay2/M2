# @configure_input@
############################### targets to use
.PHONY: check all clean config initialize doc html book distclean justM2
################################# prologue
all ::
install ::
justM2 all :: initialize config

include ../config.Makefile
VPATH = @srcdir@
################################# this directory's files
install :: $(packagedir)/COPYING
$(packagedir)/COPYING : COPYING ; cp $< "$@"
################################# bin
libexec bin :; mkdir $@
clean ::; rm -rf bin libexec
initialize :: bin libexec
################################# cache
initialize :: cache
cache :; mkdir $@
distclean clean ::; rm -rf cache
################################# util
initialize::; $(MAKE) -C util all
distclean clean ::; $(MAKE) NODEPENDS=1 -C util $@
################################# c
distclean clean ::; $(MAKE) NODEPENDS=1 -C c $@
all justM2 ::; $(MAKE) -C c all
################################# e
justM2 ::; $(MAKE) -C e all
all check ::; $(MAKE) -C e $@
distclean clean ::; $(MAKE) NODEPENDS=1 -C e $@
################################# dumpdata
ifeq "$(DUMPDATA)" "yes"
justM2 ::; $(MAKE) -C dumpdata all
all check ::; $(MAKE) -C dumpdata $@
endif
distclean clean ::; $(MAKE) NODEPENDS=1 -C dumpdata $@
################################# d
config ::; $(MAKE) NODEPENDS=1 -C d compat.h
justM2 all ::; util/restart d/restart.tmp $(MAKE) -C d all
distclean clean ::; $(MAKE) NODEPENDS=1 -C d $@
################################# basictests
all ::; $(MAKE) -C basictests -k
distclean clean ::; $(MAKE) -C basictests $@
################################# tutorial
#### keep this before 'm2' so the final/*.out files get made
justM2::; $(MAKE) -C tutorial all
install all distclean clean::; $(MAKE) -C tutorial $@
################################# m2
install distclean clean check justM2 all ::; $(MAKE) -C m2 $@
################################# test
check ::; $(MAKE) -C test -k
distclean clean ::; $(MAKE) -C test $@
################################# setup
all :: setup
	[ -x $< ] || chmod a+x $<
################################# packages
check clean distclean ::; $(MAKE) -C packages $@
################################# experiments
all distclean clean ::; if [ -d experiments ]; then $(MAKE) -C experiments $@; fi
################################# html
doc :: html
html ::; $(MAKE) -C html all
distclean clean ::; $(MAKE) -C html $@
################################# book
# doc :: book
book ::;  $(MAKE) -C book all
distclean clean ::; $(MAKE) -C book $@
################################# emacs
all ::;  $(MAKE) -C emacs all
distclean clean ::; $(MAKE) -C emacs $@
################################# libexec
install :: $(packagedir)/libexec
$(packagedir)/libexec:; $(INSTALL) -d "$@"
install ::; $(INSTALL_PROGRAM) libexec/Macaulay2 $(packagedir)/libexec
ifeq "$(DUMPDATA)" "yes"
# install ::; $(INSTALL) $(DUMPDATAFILE) $(packagedir)/$(DUMPDATAFILE)
endif
#################################
distclean::; rm -f Makefile
