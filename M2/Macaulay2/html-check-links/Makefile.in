# DEBUG = TRUE
all::
CPPFLAGS += -I../M2/include
YACC = bison
%.tab.c: %.y; $(YACC.y) $< 
%.fixed.c : %.tab.c
	sed 's="bison.simple"="/usr/share/bison.simple"=' <$< >$@.tmp
	mv $@.tmp $@
LEX = flex
LFLAGS += -f -s -i
CFLAGS += -Wall -g
HSRC := buffer.h html-check-links.h getmem.h grammar.h
CSRC := html-check-links.c getmem.c buffer.c
LSRC := lex.l
YSRC := grammar.y
SRC :=  $(YSRC) $(CSRC) $(LSRC) $(HSRC)
CFILES := $(CSRC) $(LSRC:.l=.c) $(YSRC:.y=.fixed.c)
YFLAGS += -d
YFLAGS += --verbose
LOADLIBES += -lgc
ifdef DEBUG
LDFLAGS := -g
CPPFLAGS += -DDEBUG
LFLAGS += -d
YFLAGS += --debug
endif
all:: TAGS
all:: html-check-links
%.dep : %.c; $(PREPROCESS.S) -MM $< >$@
html-check-links : $(CFILES:.c=.o)
include $(CFILES:.c=.dep)
TAGS: $(SRC); etags $^
lex.o : grammar.fixed.c
all:: test
test : html-check-links
	html-check-links test.html
bigtest : html-check-links
	html-check-links --root /Organic `find /Organic -name '*.htm*'`
clean:; rm -f	*.o html-check-links *.dep y.tab.h lex.yy.c TAGS y.output \
		core grammar.c grammar.tab.* lex.c grammar.fixed.* grammar.output
