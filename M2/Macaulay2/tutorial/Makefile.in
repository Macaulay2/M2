# @configure_input@
include ../../include/config.Makefile
VPATH = @srcdir@
FILES := Makefile tutbook.m2 titlepage.tex \
	final/--INDEX final/*.m2 prelim/*.m2 translate.c
TUTORIALS := final/Fano.m2 final/canEmbed.m2 final/divisors.m2 final/elementary.m2 final/elementary1.m2 final/modules.m2
OUTPUTS := $(TUTORIALS:.m2=.out)

# Amazingly, under WINDOWS, whether the output from translate has nonzero length
# depends in an unpredictable way on the input file name.  So we check for that
# below and use the same input file name for all.
# Names that work: tempaaa.m2 aaa
# Names that don't work: tmpaaa.m2 temp.m2 fooobaaar
TMPIN := aaa
%.out : %.m2
	cp $< $(TMPIN)
	mkdir -p `dirname $*`
	./translate <$(TMPIN) >$*.out
	[ -s $*.out ]
	rm $(TMPIN)

.PHONY : all clean distclean install check default

all:: final/cache/doc
final/cache/doc :; mkdir -p $@

all:: $(OUTPUTS)

tutbook.dvi : tutbook.tex ../book/macros.tex titlepage.tex
	tex $<
$(OUTPUTS) : translate
tutbook.tex : tutbook.m2 translate $(OUTPUTS)
	../bin/M2$(EXE) -e 'errorDepth = 0' -e 'writeExamples=true' tutbook.m2 -e 'exit 0'
	$(MAKE) -k -C Examples -f ../../m2/Makefile.egs
	../bin/M2$(EXE) -e 'readExamples=true' tutbook.m2 -e 'exit 0'

#################################
install:: $(m2dir)
install:: $(TUTORIALS) $(OUTPUTS)
	$(INSTALL_DATA) $^ "$(m2dir)"
$(m2dir) :; $(INSTALL) -d "$@"
#################################

clean :
	rm -rf *.dvi *.log translate final/*.out *.exe *.obj *.ilk *.pdb final/cache

################################# Makefile
Makefile : Makefile.in
	cd ../..; ./config.status Macaulay2/tutorial/Makefile
distclean : clean
	rm -f Makefile
