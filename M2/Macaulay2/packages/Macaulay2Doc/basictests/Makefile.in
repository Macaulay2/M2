# @configure_input@

# DOTS is the path to M2/Macaulay2 from this directory
DOTS ?= ../../..

include $(DOTS)/../include/config.Makefile
VPATH = @srcdir@

CPPFLAGS := -I$(DOTS)/../include $(CPPFLAGS) 
CPPFLAGS += -I$(DOTS)/../libraries/final/include

LDFLAGS += -L$(DOTS)/../libraries/final/lib

TESTRESULTS := $(notdir $(patsubst %.m2, %.okay, $(wildcard @srcdir@/*.m2)))

stage1 check:: $(TESTRESULTS)
distclean :: clean

$(TESTRESULTS) : @pre_exec_prefix@/bin/M2@EXE@

ARGS := --silent -q --stop --no-loaddata --no-setup -e 'srcdir = "@srcdir@/"'

%.okay : %.m2
	@ echo testing $<
	@ env @pre_exec_prefix@/bin/M2@EXE@ $(ARGS) $< -e 'exit 0'
	@ touch $@

clean::	; rm -f *.okay
LOADLIBES += -lgc
stage1:: testgc; ./testgc
clean:: ; rm -f testgc
Makefile : Makefile.in ; cd $(DOTS)/.. && ./config.status Macaulay2/packages/Macaulay2Doc/basictests/Makefile
distclean ::; rm -f Makefile
check :: check-return-code
check-return-code :; if echo 'error "foo"' | @pre_exec_prefix@/bin/M2@EXE@ $(ARGS) ; then false ; else true ; fi

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/Macaulay2/packages/Macaulay2Doc/basictests "
# End:
