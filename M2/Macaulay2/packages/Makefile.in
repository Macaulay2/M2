# @configure_input@
include ../../include/config.Makefile
VPATH = @srcdir@

LD_LIBRARY_PATH := ../../libraries/final@FINALPREFIX@/$(librariesRelDir)/lib:$(LD_LIBRARY_PATH)
export LD_LIBRARY_PATH

# here is the list of packages to install with Macaulay2, as definend in configure.ac
PACKAGES = @PACKAGES@

RemakeAllDocumentation ?= false
IgnoreExampleErrors ?= false
CheckDocumentation ?= true
RerunExamples ?= false
debugLevel ?= 0

ARGS := , MakeLinks => false
ARGS += , RerunExamples => $(RerunExamples)
ARGS += , IgnoreExampleErrors => $(IgnoreExampleErrors)
ARGS += , RemakeAllDocumentation => $(RemakeAllDocumentation)
ARGS += , CheckDocumentation => $(CheckDocumentation)
ARGS += , MakeInfo => true
ARGS += , UserMode => false
ARGS += , DebuggingMode => false

ifeq ($(ENCAP),yes)
Encapsulate = true
else
Encapsulate = false
endif

ARGS1 := $(ARGS), PackagePrefix => \"$(prefix)/\", Encapsulate => $(Encapsulate)
ARGS2 := $(ARGS), PackagePrefix => \"$(encapdir)/\", Encapsulate => false

check ::
	@ for i in $(PACKAGES) ; \
	  do ( \
	     set -x ; \
		  ../bin/M2$(EXE) -q --stop \
		    -e "needsPackage(\"$$i\",LoadDocumentation=>true); check $$i; exit 0" ; \
	     ) ; \
	  done

install :: install-Macaulay2 install-others
install-Macaulay2 ::
	@ set -x ;  ../bin/M2$(EXE) -q --stop \
		    -e errorDepth=0 \
		    -e debugLevel=$(debugLevel) \
		    -e "installPackage(\"Macaulay2\" $(ARGS1))" \
		    -e "exit 0"

install-one ::
	../bin/M2$(EXE) -q --stop -e errorDepth=0 -e debugLevel=$(debugLevel) -e "installPackage(\"$(NAMEOFPACKAGE)\" $(ARGS2))" -e "exit 0"


install-others ::
	@ for i in $(PACKAGES) ; \
	  do ( \
	      if [ "$$i" != Macaulay2 ] ; \
	      then \
		  set -x ; \
		  ../bin/M2$(EXE) -q --stop \
		    -e errorDepth=0 \
		    -e debugLevel=$(debugLevel) \
		    -e "installPackage(\"$$i\" $(ARGS2))" \
		    -e "exit 0" ; \
	      fi ; \
	     ) || exit 1 ; \
	done

clean::; rm -rf tmp *.installed

distclean::clean
clean check distclean ::; $(MAKE) -C ComputationsBook $@
Makefile: Makefile.in; cd ../..; ./config.status Macaulay2/packages/Makefile
distclean::; rm -f Makefile

## here is the list of other files to install along with Macaulay2
install :: $(packagesdir)/eliminate.m2 $(packagesdir)/packagelist $(packagesdir)/D-modules.m2
$(packagesdir)/eliminate.m2 : eliminate.m2 ; cp $^ "$@"
$(packagesdir)/D-modules.m2 : D-modules.m2 ; cp $^ "$@"
$(packagesdir)/packagelist  : packagelist  ; cp $^ "$@"

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/Macaulay2/packages "
# End:

