# -*- Mode: Makefile -*-

CONFIGURE_OPTIONS = --prefix=/tmp/Macaulay2

## to build:
##	edit the CONFIGURE_OPTIONS line above
##	make -f Makefile-configure
##	make
##      make install
## or
##      ./configure --prefix=/usr/local ...
##      make 
##      make install

## to rebuild configure script without using this makefile:
##	autoconf
##	autoheader

#############################################################################
# this list is the same as the one in configure.in
export CONFIGURED_FILES := \
	include/config.h \
	config.Makefile \
	Makefile \
	Macaulay2/Makefile \
	Macaulay2/m2/Makefile \
	Macaulay2/ComputationsBook/Makefile \
	Macaulay2/ComputationsBook/book/Makefile \
	Macaulay2/ComputationsBook/chapters/TEMPLATE/Makefile \
	Macaulay2/ComputationsBook/chapters/authorInstructions/Makefile \
	Macaulay2/ComputationsBook/chapters/completeIntersections/Makefile \
	Macaulay2/ComputationsBook/chapters/d-modules/Makefile \
	Macaulay2/ComputationsBook/chapters/sample1/Makefile \
	Macaulay2/ComputationsBook/chapters/sample2/Makefile \
	Macaulay2/ComputationsBook/chapters/schemes/Makefile \
	Macaulay2/ComputationsBook/chapters/solving/Makefile \
	Macaulay2/ComputationsBook/inputs/Makefile \
	Macaulay2/ComputationsBook/lncse-macros/Makefile \
	Macaulay2/ComputationsBook/proposals/Makefile \
	Macaulay2/ComputationsBook/util/Makefile \
	Macaulay2/Mathematica/Makefile \
	Macaulay2/Vasconcelos-appendix/Makefile \
	Macaulay2/basictests/Makefile \
	Macaulay2/benchmarks/Makefile \
	Macaulay2/benchmarks2/Makefile \
	Macaulay2/book/Makefile \
	Macaulay2/c/Makefile \
	Macaulay2/c2/Makefile \
	Macaulay2/d/Makefile \
	Macaulay2/dbm/Makefile \
	Macaulay2/docs/Makefile \
	Macaulay2/docs/nsf-final-report-2000/Makefile \
	Macaulay2/docs/nsf-proposal-1998/Makefile \
	Macaulay2/dumpdata/Makefile \
	Macaulay2/e/Makefile \
	Macaulay2/emacs/Makefile \
	Macaulay2/experiments/Makefile \
	Macaulay2/gmp-macros/Makefile \
	Macaulay2/html/Makefile \
	Macaulay2/mike-slides/Makefile \
	Macaulay2/mike-tut/Makefile \
	Macaulay2/packages/Makefile \
	Macaulay2/schubert/Makefile \
	Macaulay2/screen/Makefile \
	Macaulay2/slides/Makefile \
	Macaulay2/socket/Makefile \
	Macaulay2/test/Makefile \
	Macaulay2/tex/Makefile \
	Macaulay2/texmacs/Makefile \
	Macaulay2/thread/Makefile \
	Macaulay2/tutorial/Makefile \
	Macaulay2/util/Makefile
#############################################################################

default : stage2

stage1 : configure include/config.h.in
configure : configure.in aclocal.m4
	autoconf
include/config.h.in : configure.in aclocal.m4
	autoheader
#	touch $@

stage2 : Makefile include/config.h
config.status : configure Makefile-configure
	./configure $(CONFIGURE_OPTIONS) --no-create --cache-file=config.cache
$(CONFIGURED_FILES) : $(CONFIGURED_FILES:=.in) config.status
	./config.status
#	touch include/config.h

TARGETS = all install dist check clean distclean uninstall

$(TARGETS) :: Makefile include/config.h
	make $@

