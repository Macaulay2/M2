# @configure_input@
include ../include/config.Makefile
VPATH = @srcdir@
DEPENDS = yes
finalprefix=@FINALPREFIX@
prefixtail=$(shell echo $(finalprefix) | sed 's=^/==')
prefixdir=$(shell dirname $(finalprefix))
############################## main targets
install all :: $(PKG_DEB) tidy
#################################
# notice that fakeroot is required, get it here: http://ftp.debian.org/debian/pool/main/f/fakeroot
$(PKG_DEB) : debian-binary control.tar.gz data.tar.gz
	rm -f $@
	ar r $@ $^
CONTROLFILES := control
# CONTROLFILES += md5sums
# CONTROLFILES += preinst
CONTROLFILES += postinst
CONTROLFILES += prerm
# CONTROLFILES += postrm
control.tar.gz : $(CONTROLFILES)
	chmod a+x prerm preinst postrm postinst
	fakeroot chown root $(CONTROLFILES)
	fakeroot tar cfz $@ $^
prepare : ../$(PKG_TGZ)
	rm -rf $(package) $(prefixtail)
	$(MKDIR_P) $(prefixtail)
	tar xzfp $^
	for i in $(package)/* ; do if [ -f "$$i" ] ; then rm "$$i" ; fi ; done
	mv $(package) $(prefixtail)
	fakeroot chown -R root $(prefixtail)
data.tar.gz : prepare
	fakeroot tar cfz $@ $(prefixtail)
md5sums : prepare
	find $(prefixtail) -type f | xargs md5sum > $@
tidy :
	rm -rf $(prefixtail) control.tar.gz data.tar.gz md5sums
clean ::
	rm -rf $(package) $(prefixtail) debian-binary control.tar.gz data.tar.gz md5sums 
	rm -rf $(PKG_DEB)
distclean : clean; rm -f Makefile control

Makefile : Makefile.in; cd ..; ./config.status debian/Makefile
control : control.in; cd ..; ./config.status debian/control
prerm : prerm.in; cd ..; ./config.status debian/prerm
preinst : preinst.in; cd ..; ./config.status debian/preinst
postrm : postrm.in; cd ..; ./config.status debian/postrm
postinst : postinst.in; cd ..; ./config.status debian/postinst

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/debian "
# End:
