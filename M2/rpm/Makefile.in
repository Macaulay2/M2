# @configure_input@
include ../include/config.Makefile
VPATH = @srcdir@
DEPENDS = yes
finalprefix=@FINALPREFIX@
prefixtail=$(shell basename $(finalprefix))
prefixdir=$(shell dirname $(finalprefix))
############################## main targets
all install :: ../$(PKG_RPM)
../$(PKG_RPM) : Macaulay2.spec ../$(PKG_TGZ) Makefile
	rm -rf files
	mkdir files
	$(MKDIR_P) files$(prefixdir)
	tar xzf ../$(PKG_TGZ) -C files$(prefixdir)
	mv files$(prefixdir)/$(package) files$(prefixdir)/$(prefixtail)
	cd files$(finalprefix) && rm -f INSTALL encapinfo postinstall preremove
	rpmbuild -bb Macaulay2.spec
	rm -rf files
Macaulay2.spec : Macaulay2.spec.in Makefile files
	cp "$<" "$@"
	(cd files && find ./$(finalprefix) -type f) | sed -e 's=^./="=' -e 's=$$="=' >>"$@"
try-alien : ../$(PKG_DEB) ; fakeroot alien --generate --scripts --to-rpm $^
clean ::
distclean : clean; rm -f Makefile
Makefile : Makefile.in; cd ..; ./config.status rpm/Makefile

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/rpm "
# End:
