#! /bin/sh

# This version of the M2 script is useful while the program is being built.

# In the case where DUMPDATA=no, it's able to find all the *.m2 files 
# needed, even though they are scattered between locations in the source
# directory tree and the build directory tree.

# But, since this script uses $0 to locate the other files, it will not work
# through a symbolic link.

case "@srcdir@" in
    /*) SRCHOME="@srcdir@/../Macaulay2" ;;
     *) SRCHOME="`dirname $0`/@srcdir@/../Macaulay2" ;;
esac

M2HOME="`dirname $0`/../Macaulay2"
M2LIB="$M2HOME"
export M2HOME M2LIB

DATA="$M2HOME/cache/Macaulay2-`uname -m |sed s=/=-=g`-data"
INIPATH="-e path = { \"$SRCHOME/m2/\", \"$M2HOME/m2/\" }" \
M2PATH="-e path = join(path,{ \"$SRCHOME/m2/\", \"$SRCHOME/packages/\", \"$SRCHOME/experiments/\" })"
START="-e runStartFunctions()"

if [ -f "$DATA" ]
then SETUP="-e loaddata \"$DATA\""
     SEP="--"
else SETUP="$SRCHOME/m2/setup.m2"
     SEP=""
fi 

exec "$M2HOME/bin/Macaulay2" "$INIPATH" "$SETUP" $SEP "$M2PATH" "$START" "$@"
