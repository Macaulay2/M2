# @configure_input@
# Targets to use:
.PHONY : all check clean distclean
ifdef XYZZY
  If you get an error message on this line, it is because you are not using
  the 'gnu' version of the 'make' program.  The source code for it is
  available at ftp://ftp.gnu.org/pub/gnu/make.
endif
include include/config.Makefile
VPATH = @srcdir@

# announcement only:
install all clean distclean::
	@echo '-------- making '$@', $(PACKAGE_VERSION) for ARCH=$(ARCH) OS=$(OS) REL=$(REL) --------'

# first install target, the only place in the tree where 'all' is a prerequisite of 'install', hopefully.
install :: all

install :: ; rm -f INSTALLDIR && ln -s $(target) INSTALLDIR
distclean::; rm -f config.cache config.log config.status configure.options
distclean:: clean
ifeq "$(CC)" "cl"
all:: ;	$(MAKE) -C WindowsNT
endif
all install clean :: ; $(MAKE) -C bin $@
all install :: ; $(MAKE) -C man $@
all distclean check clean install :: ; $(MAKE) -C Macaulay2 $@
all::; $(MAKE) -C Macaulay2 doc
DIRS := $(target) $(bindir) $(libm2dir) $(man1dir) $(emacsdir) $(m2dir) $(docm2reldir)
install :: $(DIRS)
install :: ; $(MAKE) -C encap $@
$(DIRS) :; $(INSTALL) -d $@
distribution :
	tar cf - -C $(encapdir) $(package) | gzip > "Macaulay2-$(DESC).tar.gz"

################################# tar manufactured files
# this probably isn't correct any longer:
manufactured.tgz : Makefile
	$(MAKE) -C Macaulay2/d all-c-files
	$(MAKE) -C Macaulay2/tutorial
	tar cfz $@ \
		Macaulay2/e/geovec.hpp \
		Macaulay2/e/geores.hpp \
		Macaulay2/e/cmdnames.m2 \
		Macaulay2/e/cmdnames.hpp \
		Macaulay2/e/cmdinst.hpp \
		Macaulay2/m2/tutorials.m2 \
		Macaulay2/tutorial/final/*.out \
		Macaulay2/m2/gbdoc.m2 \
		Macaulay2/m2/gbfunctions.m2 \
		Macaulay2/m2/loads.m2 \
		Macaulay2/d/*.c \
		Macaulay2/m2/cache-tmp/Examples/*.m2 \
		Macaulay2/m2/cache-tmp/Tests/*.m2
distclean ::; rm -f @CONFIGURED_FILES@ include/config.h include/config.Makefile
install all clean distclean::; @echo "-------- done making '$@' --------"
