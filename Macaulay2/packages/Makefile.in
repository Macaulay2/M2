# @configure_input@
include ../../include/config.Makefile
VPATH = @srcdir@

## here is the list of those package files to install with Macaulay2
PACKAGES = Macaulay2Doc
PACKAGES += Style
PACKAGES += PrimaryDecomposition
PACKAGES += CacheFileName
PACKAGES += ConvexHulls
PACKAGES += Dmodules
PACKAGES += Elimination
PACKAGES += FirstPackage
PACKAGES += GenericInitialIdeal
PACKAGES += Markov
PACKAGES += minimal
# PACKAGES += SchurRings
##

TMPPREFIX = tmp-packages

REMAKE = false

%.installed : %.m2
	../bin/M2 \
		-q \
		--stop \
		--prefix $(TMPPREFIX) \
		-e errorDepth=0 \
		-e "installPackage(\"$*\", Encapsulate => false, RemakeAllDocumentation => $(REMAKE), MakeInfo => true, PackagePrefix => \"./$(TMPPREFIX)/\")" \
		-e "exit 0"
	touch "$@"

all :: $(PACKAGES:=.installed)

clean::; rm -rf tmp $(TMPPREFIX) *.installed
install: all; tar cf - -C $(TMPPREFIX) . | tar xfp - -C $(encapdir)

Dmodules.installed :: @srcdir@/Dmodules/*.m2

# ./tmp is used by examples in CacheFileName.m2
CacheFileName.installed : tmp
tmp : ; mkdir tmp

clean check distclean ::; $(MAKE) -C ComputationsBook $@
Makefile: Makefile.in; cd ../..; ./config.status Macaulay2/packages/Makefile
distclean::clean
distclean::; rm -f Makefile

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/Macaulay2/packages "
# End:
