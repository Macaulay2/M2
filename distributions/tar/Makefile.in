# @configure_input@
include ../../include/config.Makefile
.PHONY : src src.gz src.bz2 tarballs tarballs.gz tarballs.bz2
D=../../
S=@package@.tar
E=@package@-@MACHINE@.tar
C=@package@-common.tar
SG=$(S).gz
SJ=$(S).bz2
SZ=$(S).@COMPRESS@
EG=$(E).gz
EJ=$(E).bz2
CG=$(C).gz
CJ=$(C).bz2
pre-install :: tarballs
all pre-install ::; [ "${prefix}" = /usr -a @DEBUG@ = no -a @OPTIMIZE@ = yes -a @STRIP@ = yes ]
tarballs :: tarballs.@COMPRESS@
# these are separate targets, because they work only when online, due to the use of "svn ls":
src : $(D)$(SZ)
src.gz : $(D)$(SZ)
src.bz2 : $(D)$(SJ)
#
J=$(D)$(CJ) $(D)$(EJ)
G=$(D)$(CG) $(D)$(EG)
tarballs.bz2 : $(J)
tarballs.gz  : $(G)
clean ::; rm -rf $(J) $(G) $(D)$(SZ) $(D)$(SJ)
T=tar --create --owner=0 --group=0 --mode=a+rX,og-ws --exclude='.nfs*' --exclude='Macaulay2-*-data' --file=$@
A=--transform 's,^\.,@package@,'
B=--transform 's,^,@package@/,'
TJ=$(T) --bzip2
TG=$(T) --gzip
$(D)$(CJ) : always ; $(TJ) -C @pre_prefix@ $(A) .
$(D)$(CG) : always ; $(TG) -C @pre_prefix@ $(A) .
$(D)$(EJ) : always ; $(TJ) -C @pre_exec_prefix@ $(A) .
$(D)$(EG) : always ; $(TG) -C @pre_exec_prefix@ $(A) .
$(D)$(SJ) : always ; svn ls -R @top_srcdir@ | egrep -v '/$$' | $(TJ) -C @top_srcdir@ $(B) --files-from=-
$(D)$(SG) : always ; svn ls -R @top_srcdir@ | egrep -v '/$$' | $(TG) -C @top_srcdir@ $(B) --files-from=-
Makefile : @srcdir@/Makefile.in; cd ../..; ./config.status distributions/tar/Makefile
distclean : ; rm -rf Makefile
# Local Variables:
# compile-command: "make -C $M2BUILDDIR/distributions/tar pre-install "
# End:
